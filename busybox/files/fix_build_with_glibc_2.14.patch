UpstreamStatus: Backport

Imported from:
https://dev.openwrt.org/changeset/25507

For bug:
https://dev.openwrt.org/ticket/8850

Signed-Off-By: Nitin A Kamble <nitin.a.kamble@intel.com>
2011/10/07

Index: trunk/package/busybox/Makefile
===================================================================
--- a/Makefile
+++ b/Makefile
@@ -18,4 +18,5 @@
 PKG_MD5SUM:=a2ce1a951571da8c6e0eaf75b1acef60
 
+PKG_BUILD_DEPENDS:=librpc
 PKG_BUILD_PARALLEL:=1
 
@@ -37,4 +38,5 @@
   TITLE:=Core utilities for embedded Linux
   URL:=http://busybox.net/
+  DEPENDS:=+BUSYBOX_CONFIG_FEATURE_HAVE_RPC&&USE_UCLIBC:librpc
   MENU:=1
 endef
@@ -64,4 +66,11 @@
 endif
 
+LDLIBS:=m crypt
+ifdef CONFIG_BUSYBOX_CONFIG_FEATURE_HAVE_RPC
+  TARGET_CFLAGS += -I$(STAGING_DIR)/usr/include
+  export LDFLAGS=$(TARGET_LDFLAGS)
+  LDLIBS += rpc
+endif
+
 define Build/Compile
         $(MAKE) $(PKG_JOBS) -C $(PKG_BUILD_DIR) \
@@ -72,4 +81,5 @@
                 ARCH="$(ARCH)" \
                 SKIP_STRIP=y \
+                LDLIBS="$(LDLIBS)" \
                 all
         rm -rf $(PKG_INSTALL_DIR)
@@ -81,4 +91,5 @@
                 ARCH="$(ARCH)" \
                 CONFIG_PREFIX="$(PKG_INSTALL_DIR)" \
+                LDLIBS="$(LDLIBS)" \
                 install
 endef
